<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ms. Mona | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #6c5ce7; --dark: #4834d4; --bg: #f4f4f9; --danger: #ff7675; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); padding: 20px; color: #333; }
        
        .login-box { max-width: 400px; margin: 100px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        
        .pass-container { position: relative; width: 100%; margin: 10px 0; }
        .pass-container input { width: 100%; padding: 12px 12px 12px 45px; margin: 0; border: 1px solid #ddd; border-radius: 10px; font-family: 'Cairo'; }
        .toggle-pass { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; font-size: 1.1rem; transition: 0.3s; }
        .toggle-pass:hover { color: var(--main); }

        #adminDashboard { display: none; max-width: 850px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        h2 { color: var(--dark); font-size: 1.3rem; margin-bottom: 15px; border-right: 5px solid var(--main); padding-right: 10px; text-align: right; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-family: 'Cairo'; }
        button { background: var(--main); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        button:hover { background: var(--dark); }
        
        .list-item { background: #f9f9f9; padding: 12px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; border: 1px solid #eee; }
        .delete-btn { background: var(--danger); width: auto; padding: 5px 15px; font-size: 0.8rem; margin: 0; }
        
        .tab-menu { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-menu button { background: #fff; color: var(--main); border: 1px solid var(--main); min-width: 110px; white-space: nowrap; }
        .tab-menu button.active { background: var(--main); color: white; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        th { background: #f0eeff; color: var(--dark); }
    </style>
</head>
<body>

    <div id="loginSection" class="login-box">
        <h2 style="border:none; text-align:center;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ”</h2>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
        
        <div class="pass-container">
            <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <i class="fas fa-eye toggle-pass" id="eyeIcon" onclick="togglePassword()"></i>
        </div>
        
        <button onclick="checkAuth()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="adminDashboard">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ms. Mona ğŸ’</h1>
            <button onclick="logout()" style="width:auto; background:#636e72; padding:5px 15px;">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="tab-menu">
            <button onclick="showTab('coursesTab', this)" class="active">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</button>
            <button onclick="showTab('examsTab', this)">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
            <button onclick="showTab('resultsTab', this)">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button onclick="showTab('reviewsTab', this)">Ø§Ù„Ø¢Ø±Ø§Ø¡</button>
        </div>

        <div id="coursesTab" class="tab-content">
            <div class="card">
                <h2>1. Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯</h2>
                <input type="text" id="courseName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                <button onclick="createNewCourse()">Ø¥Ù†Ø´Ø§Ø¡</button>
                <div id="coursesListAdmin"></div>
            </div>
            <div class="card">
                <h2>2. Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ù„Ù„ÙƒÙˆØ±Ø³</h2>
                <select id="targetCourseSelect"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³...</option></select>
                <input type="text" id="videoTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³">
                <input type="text" id="videoLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨">
                <button onclick="addVideoToCourse()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
            </div>
        </div>

        <div id="examsTab" class="tab-content" style="display:none;">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>
                <select id="quizFolderSelect"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³...</option></select>
                <input type="text" id="quizName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                <div style="background:#f0eeff; padding:15px; border-radius:10px; margin:10px 0;">
                    <input type="text" id="qText" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="opt1" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 1">
                        <input type="text" id="opt2" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 2">
                        <input type="text" id="opt3" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 3">
                        <input type="text" id="opt4" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 4">
                    </div>
                    <input type="number" id="correctOpt" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (1-4)">
                </div>
                <button onclick="saveQuiz()">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
            </div>
        </div>

        <div id="resultsTab" class="tab-content" style="display:none;">
            <div class="card">
                <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <div style="overflow-x:auto;">
                    <table>
                        <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead>
                        <tbody id="resultsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="reviewsTab" class="tab-content" style="display:none;">
            <div class="card">
                <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¢Ø±Ø§Ø¡</h2>
                <div id="adminReviewsList"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8KQAQgu4nIiomoDpoTLnBz_uAtab63sY",
            databaseURL: "https://monaacademy-cd983-default-rtdb.firebaseio.com",
            projectId: "monaacademy-cd983",
            appId: "1:410646694761:web:bea49c51d3b0ff5eb9cbf8"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const secret = "TW9uYUAyMDI2"; // Mona@2026

        window.togglePassword = () => {
            const passInput = document.getElementById('adminPass');
            const eyeIcon = document.getElementById('eyeIcon');
            passInput.type = (passInput.type === 'password') ? 'text' : 'password';
            eyeIcon.classList.toggle('fa-eye');
            eyeIcon.classList.toggle('fa-eye-slash');
        };

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙÙˆØ±ÙŠ ÙˆØ§Ù„Ù…Ø­Ø³Ù†
        window.checkAuth = () => {
            const pass = document.getElementById('adminPass').value;
            
            if(btoa(pass) === secret) {
                sessionStorage.setItem('isAdminLoggedIn', 'true');
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadData();
            } else {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… replace Ù„Ù…Ù†Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ù„Ù Ø¨Ù…ØªØµÙØ­ Ø§Ù„Ù‡Ø§ØªÙ
                window.location.replace("index.html");
            }
        };

        window.logout = () => {
            sessionStorage.removeItem('isAdminLoggedIn');
            window.location.replace("index.html");
        };

        window.showTab = (tabId, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.getElementById(tabId).style.display = 'block';
            document.querySelectorAll('.tab-menu button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        // Ø¨Ø§Ù‚ÙŠ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ© (ØªØ¸Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ Ù„ØªØ¹Ù…Ù„ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­)
        function loadData() {
            onValue(ref(db, 'folders'), (snap) => {
                const sV = document.getElementById('targetCourseSelect');
                const sQ = document.getElementById('quizFolderSelect');
                const list = document.getElementById('coursesListAdmin');
                sV.innerHTML = sQ.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³...</option>';
                list.innerHTML = "";
                snap.forEach(child => {
                    const id = child.key; const name = child.val().name;
                    sV.innerHTML += `<option value="${id}">${name}</option>`;
                    sQ.innerHTML += `<option value="${id}">${name}</option>`;
                    list.innerHTML += `<div class="list-item"><span>ğŸ“‚ ${name}</span><button class="delete-btn" onclick="deleteItem('folders/${id}')">Ø­Ø°Ù</button></div>`;
                });
            });

            onValue(ref(db, 'results'), (snap) => {
                const table = document.getElementById('resultsTable');
                table.innerHTML = "";
                snap.forEach(child => {
                    const r = child.val();
                    table.innerHTML += `<tr><td>${r.student}</td><td>${r.exam}</td><td>${r.score}%</td><td>${r.date || '---'}</td></tr>`;
                });
            });

            onValue(ref(db, 'reviews'), (snap) => {
                const list = document.getElementById('adminReviewsList');
                list.innerHTML = "";
                snap.forEach(child => {
                    list.innerHTML += `<div class="list-item"><span><b>${child.val().student}:</b> ${child.val().text}</span><button class="delete-btn" onclick="deleteItem('reviews/${child.key}')">Ø­Ø°Ù</button></div>`;
                });
            });
        }

        window.createNewCourse = () => {
            const name = document.getElementById('courseName').value;
            if(name) push(ref(db, 'folders'), { name }).then(() => {
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ±Ø³"); document.getElementById('courseName').value = "";
            });
        };

        window.addVideoToCourse = () => {
            const folderId = document.getElementById('targetCourseSelect').value;
            const title = document.getElementById('videoTitle').value;
            const link = document.getElementById('videoLink').value;
            const reg = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = link.match(reg);
            if(folderId && title && match && match[2]) {
                const img = `https://img.youtube.com/vi/${match[2]}/hqdefault.jpg`;
                push(ref(db, `folders/${folderId}/videos`), { title, link, img }).then(() => {
                    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"); document.getElementById('videoTitle').value = ""; document.getElementById('videoLink').value = "";
                });
            } else { alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙˆØ±Ø³ ÙˆØµØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø·"); }
        };

        window.saveQuiz = () => {
            const folderId = document.getElementById('quizFolderSelect').value;
            const quizData = {
                name: document.getElementById('quizName').value,
                questions: [{
                    q: document.getElementById('qText').value,
                    options: [document.getElementById('opt1').value, document.getElementById('opt2').value, document.getElementById('opt3').value, document.getElementById('opt4').value],
                    correct: document.getElementById('correctOpt').value
                }]
            };
            if(folderId && quizData.name) {
                push(ref(db, `quizzes/${folderId}`), quizData).then(() => alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†"));
            } else { alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„"); }
        };

        window.deleteItem = (path) => { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) remove(ref(db, path)); };
    </script>
</body>
</html>
